{% extends "sagelist/base.html" %}
{% block "title" %}SageBooks{% endblock %}
{% block "full_content" %}
<h1>SageBooks Textbook Sales</h1>
<ul class="actions">
  <li><a href="{% url "sagelist_create" %}">List a book for sale</a></li>
  {% if user.is_authenticated %}
  <li><a href="{% url "sagelist_user_listings" username=user.username %}">View my listings</a></li>
  {% endif %}
</ul>

<div class="stat_search">
  <ul class="stats">
    {% if total_for_sale %}<li>{{ total_for_sale }} book{% if total_for_sale != 1 %}s{% endif %} for sale</li>{% endif %}
    {% if total_sold %}<li>{{ total_sold }} book{% if total_sold != 1 %}s{% endif %} sold</li>{% endif %}
  </ul>
  <form action="." method="GET" id="search_form">
    {% if search %}
      <a href=".">clear</a>
    {% endif %}{{ form.search }}
    <input type="submit" value="search">
  </form>

</div>

{% if listings %}
  {% if is_paginated %}
  <ol class="pagenav">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}">previous</a>
      {% endif %}
      {% for num in paginator.page_range %}
        {% ifequal num page_obj.number %}
          <span class="current_page">{{ forloop.counter }}</span>
        {% else %}
        <li>
          <a href="?page={{ forloop.counter }}">{{ forloop.counter }}</a>
        </li>
        {% endifequal %}
      {% endfor %}
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}">next</a>
      {% endif %}
  </ol>
  {% endif %}

  <table>
    <tr>
      <th class="title">Title</th>
      <th class="authors">Author(s)</th>
      <th class="isbn">ISBN</th>
      <th class="condition">Condition</th>
      <th class="price">Price</th>
      <th class="recoop">ReCoop</th>
    </tr>
  {% for book in listings %}
    <tr>
      <td class="title"><a href="{% url "sagelist_detail" pk=book.id %}">{{ book.title }}</a>{% if book.edition %} [{{ book.edition }} ed.]{% endif %}</td>
      <td class="authors">{{ book.authors }}</td>
      <td class="isbn">{{ book.isbn }}</td>
      <td class="condition">{{ book.get_condition_display }}</td>
      <td class="price">${{ book.price }}</td>
      <td class="recoop">{% if book.is_recoop %} <img src="{{ STATIC_URL }}img/recoop_listing_icon.png" /> {% endif %}</td>
    </tr>
  {% endfor %}
  </table>
  {% else %}
  <p class="list_empty content">{% if not search %}No books are currently listed for sale.{% else %}No book listings matched your search. <a href="{% url "sagelist_create" %}">Post a new one?</a>{% endif %}</p>
{% endif %}
{% endblock %}